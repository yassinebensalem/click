@using Microsoft.AspNetCore.Identity
@using DDD.Domain.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@using Microsoft.Extensions.Localization
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.AspNetCore.Localization
@inject IStringLocalizer<SharedResource> SharedLocalizer
@using Microsoft.AspNetCore.Builder
@using DDD.Application.ViewModels;
@model PrizeDetailsVM


@{
	var requestCulture = Context.Features.Get<IRequestCultureFeature>();
	var selectedCulture = requestCulture.RequestCulture.Culture;
}

<div class="product product__space product__space-primary border bg-white">
	<div class="product__inner overflow-hidden p-3 p-md-4d875">
		<div class="woocommerce-LoopProduct-link woocommerce-loop-product__link d-block position-relative">
			<div class="col-md-auto woocommerce-loop-product__thumbnail mb-3 mb-md-0">
				<a asp-action="GetBookDetails" asp-controller="Book" asp-route-BookInfos="@($"{Model.SingleBook.Id}#{Model.SingleBook.Title.Replace(" ", "-")}")" class="d-block mb-2">
					<img loading="lazy" src="@($"https://miplivrelstorage.blob.core.windows.net/bookscover/{Model.SingleBook.CoverPath}")" class="img-fluid single-book  d-block mx-auto attachment-shop_catalog size-shop_catalog wp-post-image img-fluid" alt="Book Cover">
				</a>
				@if (Model.SingleBook.PromotionsPercentage != 0 && Model.SingleBook.PromotionsPercentage != 100)
				{
					<span class="badge badge-md bg-primary position-absolute badge-pos--top-right text-white rounded-circle d-flex flex-column align-items-center justify-content-center text-uppercase " style="@(selectedCulture.Name.Equals("fr-FR") ? " font-size:0.625rem;" : "")">
						- @Model.SingleBook.PromotionsPercentage %
					</span>
				}
				else if (Model.SingleBook.PromotionsPercentage == 100)
				{
					<span class="badge badge-md badge-primary-green position-absolute badge-pos--top-right text-white rounded-circle d-flex flex-column align-items-center justify-content-center text-uppercase " style="@(selectedCulture.Name.Equals("fr-FR") ? " font-size:0.625rem;" : "")">
						@SharedLocalizer["Book.Free"]
					</span>
				}
			</div>
			<div class="col-md woocommerce-loop-product__body product__body pt-3 bg-white mb-3 mb-md-0">
				<div class="text-uppercase font-size-1 mb-1 text-truncate"> </div>
				<h2 class="woocommerce-loop-product__title product__title h6 text-lh-md mb-1 text-height-2 crop-text-2 h-dark">
					<a asp-action="GetBookDetails" asp-controller="Book" asp-route-BookInfos="@($"{Model.SingleBook.Id}#{Model.SingleBook.Title.Replace(" ", "-")}")">@Model.SingleBook.Title</a>
				</h2>
				<div class="font-size-2  mb-2 text-truncate"><a asp-controller="Prized" asp-action="Details" asp-route-Id="@($"{Model.Prize.Id}")" class="text-gray-700">@Model.Prize.Name</a></div>

				<div class="price d-flex align-items-center font-weight-medium font-size-3">
					@if (Model.SingleBook.PromotionsPercentage != 0 && Model.SingleBook.PromotionsPercentage != 100)
					{
						<span class="woocommerce-Price-amount amount height-38 width-60" style="text-decoration: line-through;">
							@Model.SingleBook.BusinessPrice @SharedLocalizer["Book.Currency"]
						</span>
						<span class="woocommerce-Price-amount amount height-38 width-60 px-2">
							@(Model.SingleBook.BusinessPrice - (Model.SingleBook.BusinessPrice * Model.SingleBook.PromotionsPercentage / 100)) @SharedLocalizer["Book.Currency"]
						</span>
					}
					else if (Model.SingleBook.PromotionsPercentage == 100)
					{
						<span class="woocommerce-Price-amount amount height-38 width-60" style="text-decoration: line-through;">
							@Model.SingleBook.BusinessPrice @SharedLocalizer["Book.Currency"]
						</span>
					}
					else
					{
						<span class="woocommerce-Price-amount amount height-38 width-60">
							@Model.SingleBook.BusinessPrice @SharedLocalizer["Book.Currency"]
						</span>
					}
				</div>
			</div>
			<div class="product__hover d-flex align-items-center pb-1">
				@if (!(Model.SingleBook.PromotionsPercentage == 100))
				{
					if (SignInManager.IsSignedIn(User))
					{
						@if (User.IsInRole("Subscriber"))
						{
							<a value="@Model.SingleBook.Id" data-cart="@Model.SingleBook.inCart" class="addToCartLink text-uppercase text-dark h-dark font-weight-medium arrow-cursor @(selectedCulture.Name.Equals("ar") ? "ml-auto" : " mr-auto")" style=" font-size:14px;">
								<span class="product__add-to-cart text-center" style="@(Model.SingleBook.inCart ? "color: #f75454" : "")">
									@(Model.SingleBook.inCart ? @SharedLocalizer["Book.RemoveFromCart"] : @SharedLocalizer["Book.AddToCart"])
								</span>
								<span class="product__add-to-cart-icon h-p-bg btn btn-outline-primary border-0" style="@(Model.SingleBook.inCart ? "background-color: #f75454" : "")">
									<i class="flaticon-icon-126515 text-black" style="display: inline-block;"></i>
								</span>
							</a>
						}
					}

					else
					{
						<a id="sidebarNavTogglerLogin" href="javascript:;" role="button"
				   class="text-black text-uppercase text-dark h-dark font-weight-medium arrow-cursor @(selectedCulture.Name.Equals("ar") ? "ml-auto" : " mr-auto")"
				   aria-controls="sidebarContent"
				   aria-haspopup="true"
				   aria-expanded="false"
				   data-unfold-event="click"
				   data-unfold-hide-on-scroll="false"
				   data-unfold-target="#sidebarContent"
				   data-unfold-type="css-animation"
				   data-unfold-overlay='{
			                                                        "className": "u-sidebar-bg-overlay",
			                                                        "background": "rgba(0, 0, 0, .7)",
			                                                        "animationSpeed": 500
		                                                        }'
				   data-unfold-animation-in="fadeInRight"
				   data-unfold-animation-out="fadeOutRight"
				   data-unfold-duration="50">
							<span class="product__add-to-cart text-center" style="font-size:14px;">
								@SharedLocalizer["Book.AddToCart"]
							</span>
							<span class="product__add-to-cart-icon h-p-bg btn btn-outline-primary border-0">
								<i class="flaticon-icon-126515 text-black" style="display: inline-block;"></i>
							</span>
						</a>
					}
				}
				else
				{
					if (SignInManager.IsSignedIn(User))
					{
						if (Model.SingleBook.CanBeAddedToLib)
						{
							<a value="@Model.SingleBook.Id" data-library="@Model.SingleBook.inLibrary" class="addToLibraryLink text-uppercase text-dark h-dark font-weight-medium arrow-cursor @(selectedCulture.Name.Equals("ar") ? "ml-auto" : " mr-auto")" style="font-size:14px;">
								<span class="product__add-to-cart text-center" style="@(Model.SingleBook.inCart ? "color: #f75454" : "")">
									@(Model.SingleBook.inLibrary ? @SharedLocalizer["Book.RemoveFromLibrary"] : @SharedLocalizer["Book.AddToLibrary"])
								</span>
								<span class="product__add-to-cart-icon h-p-bg btn btn-outline-primary border-0" style="@(Model.SingleBook.inLibrary ? "background-color: #f75454" : "")">
									<i class="flaticon-credit text-black" style="display: inline-block;"></i>
								</span>
							</a>
						}
						else
						{
							<a value="@Model.SingleBook.Id" data-cart="@Model.SingleBook.inCart" class="addToCartLink text-uppercase text-dark h-dark font-weight-medium arrow-cursor @(selectedCulture.Name.Equals("ar") ? "ml-auto" : " mr-auto")"
				   style="font-size: 14px;">
								<span class="product__add-to-cart text-center" style="@(Model.SingleBook.inCart ? "color: #f75454" : "") ">
									@(Model.SingleBook.inCart ? @SharedLocalizer["Book.RemoveFromCart"] : @SharedLocalizer["Book.AddToCart"])
								</span>
								<span class="product__add-to-cart-icon h-p-bg btn btn-outline-primary border-0" style="@(Model.SingleBook.inCart ? "background-color: #f75454" : "")">
									<i class="flaticon-icon-126515 text-black" style="display: inline-block;"></i>
								</span>
							</a>
						}
					}
					else
					{
						<a id="sidebarNavTogglerLogin" href="javascript:;" role="button"
				   class="text-black text-uppercase text-dark h-dark font-weight-medium arrow-cursor @(selectedCulture.Name.Equals("ar") ? "ml-auto" : " mr-auto")"
				   aria-controls="sidebarContent"
				   aria-haspopup="true"
				   aria-expanded="false"
				   data-unfold-event="click"
				   data-unfold-hide-on-scroll="false"
				   data-unfold-target="#sidebarContent"
				   data-unfold-type="css-animation"
				   data-unfold-overlay='{
			                                                        "className": "u-sidebar-bg-overlay",
			                                                        "background": "rgba(0, 0, 0, .7)",
			                                                        "animationSpeed": 500
		                                                        }'
				   data-unfold-animation-in="fadeInRight"
				   data-unfold-animation-out="fadeOutRight"
				   data-unfold-duration="50">
							<span class="product__add-to-cart text-center" style="font-size:14px;">
								@SharedLocalizer["Book.AddToLibrary"]
							</span>
							<span class="product__add-to-cart-icon h-p-bg btn btn-outline-primary border-0">
								<i class="flaticon-credit text-black" style="display: inline-block;"></i>
							</span>
						</a>
					}
				}

				@if (SignInManager.IsSignedIn(User))
				{
					<a onclick="getBookPDFContent(this);" data-id="@Model.SingleBook.Id" data-Title="@Model.SingleBook.Title" class="mr-1 h-p-bg btn btn-outline-primary border-0 font-weight-bold">
						<i class="flaticon-multimedia"></i>
					</a>
					@if (User.IsInRole("Subscriber"))
					{
						<a value="@Model.SingleBook.Id" data-favorite="@Model.SingleBook.isFavorite" style="@(Model.SingleBook.isFavorite?"background-color: #f75454":"")" class="addToFavoriteLink h-p-bg btn btn-outline-primary border-0">
							<i id="addToFavoriteIcon" class="flaticon-heart"></i>
						</a>
					}
				}
				else
				{
					<a id="sidebarNavTogglerLogin" href="javascript:;" role="button" class="h-p-bg btn btn-outline-primary border-0"
				   aria-controls="sidebarContent"
				   aria-haspopup="true"
				   aria-expanded="false"
				   data-unfold-event="click"
				   data-unfold-hide-on-scroll="false"
				   data-unfold-target="#sidebarContent"
				   data-unfold-type="css-animation"
				   data-unfold-overlay='{

			                                                        "className": "u-sidebar-bg-overlay",
			                                                        "background": "rgba(0, 0, 0, .7)",
			                                                        "animationSpeed": 500
		                                                        }'
				   data-unfold-animation-in="fadeInRight"
				   data-unfold-animation-out="fadeOutRight"
				   data-unfold-duration="50">
						<i class="flaticon-multimedia"></i>
					</a>
					<a id="sidebarNavTogglerLogin" href="javascript:;" role="button" class="h-p-bg btn btn-outline-primary border-0"
				   aria-controls="sidebarContent"
				   aria-haspopup="true"
				   aria-expanded="false"
				   data-unfold-event="click"
				   data-unfold-hide-on-scroll="false"
				   data-unfold-target="#sidebarContent"
				   data-unfold-type="css-animation"
				   data-unfold-overlay='{

			                                                        "className": "u-sidebar-bg-overlay",
			                                                        "background": "rgba(0, 0, 0, .7)",
			                                                        "animationSpeed": 500
		                                                        }'
				   data-unfold-animation-in="fadeInRight"
				   data-unfold-animation-out="fadeOutRight"
				   data-unfold-duration="50">
						<i class="flaticon-heart"></i>
					</a>
				}
			</div>
		</div>
	</div>
</div>
